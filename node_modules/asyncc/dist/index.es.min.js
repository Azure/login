var t="object"==typeof process&&"function"==typeof process.nextTick?process.nextTick:"function"==typeof setImmediate?setImmediate:function(t){setTimeout(t,0)},n=function(t){function n(n,i,e){t.call(this,n),Object.assign(this,{name:"AsynccError",message:n,errors:i,errpos:e,stack:this.stack||(new t).stack})}return t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n,n}(Error);function i(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return 1===t.length&&Array.isArray(t[0])&&(t=t[0]),function(n,i){var e=0;!function n(r,s){var o=t[e++];r||!o?i&&i(r,s):o(s,n)}(null,n)}}function e(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return 1===t.length&&Array.isArray(t[0])&&(t=t[0]),function(n,i){var e=0;!function n(r,s){var o=t[e++];try{if(r){for(;o&&3!==o.length;)o=t[e++];o&&o(r,s,n)}else{for(;o&&o.length>2;)o=t[e++];o&&o(s,n)}}catch(t){n(t,s)}o||i&&i(r,s)}(null,n)}}function r(n,i,e){var r=0;function s(n,s){n||i(r)?e&&e(n,s):t((function(){o()}))}function o(){n(s,r++)}o()}function s(t,n,i){r(t,(function(t){return!n(t)}),i)}function o(t,i,e,r,s){void 0===r&&(r={}),"function"==typeof r&&(s=r,r={}),t=Math.abs(t||i);var o=[],u=new Array(i).fill(),c=new Array(i).fill(),h=0,f=i,a=0;if(0!==f)for(r.timeout&&setTimeout((function(){f&&l("err_timeout")}),r.timeout),t=t<i?t:i;h<t;)e(h++,p);else l();function l(t){if(!a++){var i=null;(o.length||t)&&(i=new n(t||"err",u,o)),s&&s(i,c)}}function p(t,n,s){c[t]=s,u[t]=n,n&&(o.push(t),r.bail)?l("err_bail"):(f--,h<i?e(h++,p):f||l())}}function u(t,n,i,e,r){o(t,n.length,(function(t,e){i(n[t],(function(n,i){e(t,n,i)}),t)}),e,r)}function c(t,n,i,e){u(0,t,n,i,e)}function h(n,i,e){var r=n.length,s=[],o=0;function u(n,i){s.push(i),n||r===o?e&&e(n,s):o<r&&t((function(){c()}))}function c(){i(n[o],u,o++)}0!==r?c():e(null,[])}function f(t){this._tasks=[],this.result=t,this.error=void 0,this._lock=!1}function a(t){return new f(t)}function l(t,n,i,e){o(t,n.length,(function(t,i){n[t]((function(n,e){i(t,n,e)}))}),i,e)}function p(t,n,i){l(0,t,n,i)}function _(){this.reset()}function m(t,n){this._task=t,this._concurrency=Math.abs(n||1),this._worker=0,this._paused=!1,this._items=new _}function y(t,n){return new m(t,n)}function g(n,i){i=i||{};var e=t,r=0,s=n;return"number"!=typeof n&&(s=n.times,r=n.lag||0),s=s||i.times||0,r&&(e=setTimeout),{times:s,lag:r,fn:e}}function v(t,n,i){var e=0,r=g(t,{times:2}),s=r.times,o=r.lag,u=r.fn;function c(t,n){!t||e>=s?i&&i(t,n):u((function(){h()}),o)}function h(){n(c,e++)}h()}function k(n,i){var e=n.length,r=[],s=0;function o(){n[s++](u)}function u(n,u){r.push(u),n||e===s?i&&i(n,r):s<e&&t((function(){o()}))}0!==e?o():i(null,[])}function d(t,n,i){var e=0,r=g(t),s=r.times,o=r.lag,u=r.fn;function c(t,n){t||s>0&&e>=s?i&&i(t,n):u((function(){h()}),o)}function h(){n(c,e++)}s?h():i&&i()}function w(n,i,e){var r=0;function s(i,s){i||n(r)?e&&e(i,s):t((function(){o()}))}function o(){i(s,r++)}n(r)?e&&e():o()}function b(t,n,i){w((function(n){return!t(n)}),n,i)}f.prototype={_run:function(){var t=this;if(!this._lock){this._lock=!0;for(var n=this._tasks.shift(),i=this.error?["catch","end"]:["then","end"];n&&!~i.indexOf(n.type);)n=this._tasks.shift();if(n){var e=function(n,i){t.error=n,t.result=i||t.result,t._lock=!1,t._run()},r=n.fn;if("end"===n.type)r(this.error,this.result);else try{"catch"===n.type?r(this.error,this.result,e):r(this.result,e)}catch(t){e(t)}}else this._lock=!1}},then:function(t){return this._tasks.push({type:"then",fn:t}),this._run(),this},catch:function(t){return this._tasks.push({type:"catch",fn:t}),this._run(),this},end:function(t){this._tasks.push({type:"end",fn:t}),this._run()}},_.prototype={get length(){return this.items.length},shift:function(){return(this.items.shift()||{}).item},push:function(t,n){var i=this.items;if("number"!=typeof n)n=1/0,i.push({prio:n,item:t});else{var e;n=Math.abs(n);for(var r=0;r<i.length;r++)if(n<i[r].prio){i.splice(r,0,{prio:n,item:t}),e=!0;break}e||i.push({prio:n,item:t})}return this},unshift:function(t){return this.items.unshift({prio:0,item:t}),this},reset:function(){this.items=[]}},m.prototype={_run:function(){var n=this,i=this._items,e=this._drain;if(this._worker-=1,0===i.length)this._worker<=0&&(this._worker=0,e&&e());else{this._worker+=1;var r=i.shift(),s=r[0],o=r[1];this._task(s,(function(i,e){o&&o(i,e),t((function(){n._run()}))}))}},_start:function(){for(;!this._paused&&this._worker<Math.min(this._concurrency,this._items.length);)this._worker+=1,this._run();return this},get paused(){return this._paused},get idle(){return!this.length&&0===this._worker},get length(){return this._items.length},pause:function(){return this._paused=!0,this},resume:function(){return this._paused=!1,this._start()},reset:function(){return this._items.reset(),this},running:function(){return this._worker},push:function(t,n,i){return this.concat([t],n,i)},concat:function(t,n,i){var e=this;return"number"==typeof n&&(i=n,n=void 0),t.forEach((function(t){e._items.push([t,n],i)})),this._start()},unshift:function(t,n){return this._items.unshift([t,n]),this._start()},drain:function(t){return this._drain=t,this}};var A={_setImmediate:t,AsynccError:n,compose:i,connect:e,doUntil:r,doWhilst:s,each:c,eachLimit:u,eachSeries:h,noPromise:a,NoPromise:f,parallel:p,parallelLimit:l,queue:y,Queue:m,retry:v,series:k,times:d,until:w,whilst:b};export{n as AsynccError,f as NoPromise,m as Queue,t as _setImmediate,i as compose,e as connect,A as default,r as doUntil,s as doWhilst,c as each,u as eachLimit,h as eachSeries,a as noPromise,p as parallel,l as parallelLimit,y as queue,v as retry,k as series,d as times,w as until,b as whilst};
