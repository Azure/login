"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _setImmediate="object"==typeof process&&"function"==typeof process.nextTick?process.nextTick:"function"==typeof setImmediate?setImmediate:function(t){setTimeout(t,0)},AsynccError=function(t){function e(e,i,n){t.call(this,e),Object.assign(this,{name:"AsynccError",message:e,errors:i,errpos:n,stack:this.stack||(new t).stack})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error);function compose(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return 1===t.length&&Array.isArray(t[0])&&(t=t[0]),function(e,i){var n=0;!function e(r,s){var o=t[n++];r||!o?i&&i(r,s):o(s,e)}(null,e)}}function connect(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];return 1===t.length&&Array.isArray(t[0])&&(t=t[0]),function(e,i){var n=0;!function e(r,s){var o=t[n++];try{if(r){for(;o&&3!==o.length;)o=t[n++];o&&o(r,s,e)}else{for(;o&&o.length>2;)o=t[n++];o&&o(s,e)}}catch(t){e(t,s)}o||i&&i(r,s)}(null,e)}}function doUntil(t,e,i){var n=0;function r(t,r){t||e(n)?i&&i(t,r):_setImmediate((function(){s()}))}function s(){t(r,n++)}s()}function doWhilst(t,e,i){doUntil(t,(function(t){return!e(t)}),i)}function parallel(t,e,i,n,r){void 0===n&&(n={}),"function"==typeof n&&(r=n,n={}),t=Math.abs(t||e);var s=[],o=new Array(e).fill(),u=new Array(e).fill(),c=0,h=e,a=0;if(0!==h)for(n.timeout&&setTimeout((function(){h&&l("err_timeout")}),n.timeout),t=t<e?t:e;c<t;)i(c++,f);else l();function l(t){if(!a++){var e=null;(s.length||t)&&(e=new AsynccError(t||"err",o,s)),r&&r(e,u)}}function f(t,r,a){u[t]=a,o[t]=r,r&&(s.push(t),n.bail)?l("err_bail"):(h--,c<e?i(c++,f):h||l())}}function eachLimit(t,e,i,n,r){parallel(t,e.length,(function(t,n){i(e[t],(function(e,i){n(t,e,i)}),t)}),n,r)}function each(t,e,i,n){eachLimit(0,t,e,i,n)}function eachSeries(t,e,i){var n=t.length,r=[],s=0;function o(t,e){r.push(e),t||n===s?i&&i(t,r):s<n&&_setImmediate((function(){u()}))}function u(){e(t[s],o,s++)}0!==n?u():i(null,[])}function NoPromise(t){this._tasks=[],this.result=t,this.error=void 0,this._lock=!1}function noPromise(t){return new NoPromise(t)}function parallelLimit(t,e,i,n){parallel(t,e.length,(function(t,i){e[t]((function(e,n){i(t,e,n)}))}),i,n)}function parallel$1(t,e,i){parallelLimit(0,t,e,i)}function PrioArray(){this.reset()}function Queue(t,e){this._task=t,this._concurrency=Math.abs(e||1),this._worker=0,this._paused=!1,this._items=new PrioArray}function queue(t,e){return new Queue(t,e)}function _times(t,e){e=e||{};var i=_setImmediate,n=0,r=t;return"number"!=typeof t&&(r=t.times,n=t.lag||0),r=r||e.times||0,n&&(i=setTimeout),{times:r,lag:n,fn:i}}function retry(t,e,i){var n=0,r=_times(t,{times:2}),s=r.times,o=r.lag,u=r.fn;function c(t,e){!t||n>=s?i&&i(t,e):u((function(){h()}),o)}function h(){e(c,n++)}h()}function series(t,e){var i=t.length,n=[],r=0;function s(){t[r++](o)}function o(t,o){n.push(o),t||i===r?e&&e(t,n):r<i&&_setImmediate((function(){s()}))}0!==i?s():e(null,[])}function times(t,e,i){var n=0,r=_times(t),s=r.times,o=r.lag,u=r.fn;function c(t,e){t||s>0&&n>=s?i&&i(t,e):u((function(){h()}),o)}function h(){e(c,n++)}s?h():i&&i()}function until(t,e,i){var n=0;function r(e,r){e||t(n)?i&&i(e,r):_setImmediate((function(){s()}))}function s(){e(r,n++)}t(n)?i&&i():s()}function whilst(t,e,i){until((function(e){return!t(e)}),e,i)}NoPromise.prototype={_run:function(){var t=this;if(!this._lock){this._lock=!0;for(var e=this._tasks.shift(),i=this.error?["catch","end"]:["then","end"];e&&!~i.indexOf(e.type);)e=this._tasks.shift();if(e){var n=function(e,i){t.error=e,t.result=i||t.result,t._lock=!1,t._run()},r=e.fn;if("end"===e.type)r(this.error,this.result);else try{"catch"===e.type?r(this.error,this.result,n):r(this.result,n)}catch(t){n(t)}}else this._lock=!1}},then:function(t){return this._tasks.push({type:"then",fn:t}),this._run(),this},catch:function(t){return this._tasks.push({type:"catch",fn:t}),this._run(),this},end:function(t){this._tasks.push({type:"end",fn:t}),this._run()}},PrioArray.prototype={get length(){return this.items.length},shift:function(){return(this.items.shift()||{}).item},push:function(t,e){var i=this.items;if("number"!=typeof e)e=1/0,i.push({prio:e,item:t});else{var n;e=Math.abs(e);for(var r=0;r<i.length;r++)if(e<i[r].prio){i.splice(r,0,{prio:e,item:t}),n=!0;break}n||i.push({prio:e,item:t})}return this},unshift:function(t){return this.items.unshift({prio:0,item:t}),this},reset:function(){this.items=[]}},Queue.prototype={_run:function(){var t=this,e=this._items,i=this._drain;if(this._worker-=1,0===e.length)this._worker<=0&&(this._worker=0,i&&i());else{this._worker+=1;var n=e.shift(),r=n[0],s=n[1];this._task(r,(function(e,i){s&&s(e,i),_setImmediate((function(){t._run()}))}))}},_start:function(){for(;!this._paused&&this._worker<Math.min(this._concurrency,this._items.length);)this._worker+=1,this._run();return this},get paused(){return this._paused},get idle(){return!this.length&&0===this._worker},get length(){return this._items.length},pause:function(){return this._paused=!0,this},resume:function(){return this._paused=!1,this._start()},reset:function(){return this._items.reset(),this},running:function(){return this._worker},push:function(t,e,i){return this.concat([t],e,i)},concat:function(t,e,i){var n=this;return"number"==typeof e&&(i=e,e=void 0),t.forEach((function(t){n._items.push([t,e],i)})),this._start()},unshift:function(t,e){return this._items.unshift([t,e]),this._start()},drain:function(t){return this._drain=t,this}};var index={_setImmediate:_setImmediate,AsynccError:AsynccError,compose:compose,connect:connect,doUntil:doUntil,doWhilst:doWhilst,each:each,eachLimit:eachLimit,eachSeries:eachSeries,noPromise:noPromise,NoPromise:NoPromise,parallel:parallel$1,parallelLimit:parallelLimit,queue:queue,Queue:Queue,retry:retry,series:series,times:times,until:until,whilst:whilst};exports.AsynccError=AsynccError,exports.NoPromise=NoPromise,exports.Queue=Queue,exports._setImmediate=_setImmediate,exports.compose=compose,exports.connect=connect,exports.default=index,exports.doUntil=doUntil,exports.doWhilst=doWhilst,exports.each=each,exports.eachLimit=eachLimit,exports.eachSeries=eachSeries,exports.noPromise=noPromise,exports.parallel=parallel$1,exports.parallelLimit=parallelLimit,exports.queue=queue,exports.retry=retry,exports.series=series,exports.times=times,exports.until=until,exports.whilst=whilst;
